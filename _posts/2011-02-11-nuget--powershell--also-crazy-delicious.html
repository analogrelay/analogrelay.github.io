---
layout: post
title: "NuGet + PowerShell = (also) Crazy Delicious"
description: ""
category:
tags: []
permalink: /blog/2011/2/10/nuget-powershell-also-crazy-delicious.html
---
<p>First off, I should note that I'm kinda paraphrasing this title from Scott Hanselman's <a href="http://www.hanselman.com/blog/PDC10BuildingABlogWithMicrosoftUnnamedPackageOfWebLove.aspx">excellent PDC 2010 talk</a>, but I'm sure he's ok with that<img class="wlEmoticon wlEmoticon-smile" style="border-style: none;" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/wlEmoticon-smile_2.png" alt="Smile" />. By now, if you've been following the news coming out of the Microsoft Web Platform and Tools team, you've probably heard about our latest open-source project: NuGet. I'll let <a href="http://weblogs.asp.net/scottgu/archive/2011/01/13/announcing-release-of-asp-net-mvc-3-iis-express-sql-ce-4-web-farm-framework-orchard-webmatrix.aspx">Scott Guthrie</a> fill you in if you haven't heard about it already. Well, since shipping Web Pages v1/MVC v3, we've been working on general clean-up of both our code and our processes. For me, part of that entailed wiping all my dev machines and re-installing from scratch (there's a certain level of happiness provided by a nice fresh machine <img class="wlEmoticon wlEmoticon-smile" style="border-style: none;" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/wlEmoticon-smile_2.png" alt="Smile" />). As part of that, I was organizing my little PowerShell utility scripts into <a href="http://msdn.microsoft.com/en-us/library/dd878324(VS.85).aspx">Modules</a>. I've also been thinking of organizing them a bit so that they could be released, but I ran in to a problem: There isn't really a great way to distribute PowerShell Modules!</p>
<p>In PowerShell, a Module is really just a script within a special folder. When you "Import" the module, the script is run and the functions/variables/etc. it exports are added to the shell environment. There's much more to it, but I'll leave it to MSDN to explain the rest if you're interested.</p>
<p>Deploying a Module is as simple as dropping a folder in C:\Users\[user name]\Documents\WindowsPowerShell\Modules. But in order to get a Module from the Web, like say the very useful <a href="http://pscx.codeplex.com/">PowerShell Community Extensions</a> package, you have to download a ZIP and extract it to the right place. Earlier this week I had a brainwave: "Isn't this _exactly_ what NuGet is designed to do?"</p>
<p>So, I spent a bit of spare time working on something I call "PsGet", which I'm releasing a very early version of <strong>right now</strong>. PsGet is a PowerShell Module that uses NuGet to deploy other PowerShell Modules. Right now, you do have to manually install PsGet, but I'm hoping to set up a single bootstrapping script that you can download and run to install it automatically. Let's walk through how it works:</p>
<p>First, download the PsGetBoot module from the <a href="http://code.andrewnurse.net/psget">BitBucket site</a> I've set up. <a href="http://code.andrewnurse.net/psget/downloads/PsGetBoot-0.1.0.0.zip">Here's a direct link to the ZIP file</a>. Then, make sure the ZIP is unblocked in Explorer:</p>
<p><a href="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_2.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="image" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_thumb.png" border="0" alt="image" width="380" height="518" /></a></p>
<p>Now, open/create your PowerShell Modules folder in Explorer. It needs to go in "C:\Users\[username]\Documents\WindowsPowerShell\Modules". If you have moved your My Documents folder (like I have, to the D: drive in this case), you should update the path accordingly. Open the ZIP file in Explorer and copy the PsGetBoot folder into your Modules folder:</p>
<p><a href="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_4.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="image" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_thumb_1.png" border="0" alt="image" width="922" height="522" /></a></p>
<p>Next, you need to ensure you've enabled the execution of unsigned scripts. If you've already done this, skip this step. Start a PowerShell window as Administrator and run the following command: "Set-ExecutionPolicy RemoteSigned". Enter "Y" at the confirmation prompt.</p>
<p><a href="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_6.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="image" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_thumb_2.png" border="0" alt="image" width="530" height="106" /></a></p>
<p>Ok, if you skipped the last step, open a PowerShell window. Otherwise, you've already got one open <img class="wlEmoticon wlEmoticon-smile" style="border-style: none;" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/wlEmoticon-smile_2.png" alt="Smile" />. Now we need to open your profile script and add a line to activate PsGet. The profile script is the script that runs every time you open PowerShell. First, let's make sure all the necessary folders exist by running:</p>
<pre class="brush: ps">mkdir (Split-Path -Parent $profile)</pre>
<p>If you get an error saying the item already exists, don't worry, it just means you didn't need to do this step <img class="wlEmoticon wlEmoticon-smile" style="border-style: none;" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/wlEmoticon-smile_2.png" alt="Smile" />. Next, open your profile script up in notepad (or your favorite text editor) and make sure to create it if it doesn't already exist:</p>
<pre class="ps">notepad $profile</pre>
<p>Type the following somewhere in the main body of your profile. It can go at the end, the beginning, or the middle, but <strong>not </strong>within a function:</p>
<pre class="brush: ps">Import-Module PsGetBoot</pre>
<p>Then save the file, shutdown your PowerShell windows and open up a new one (Admin privileges are NOT required this time). The line we added to the PowerShell Profile will load in the PsGet "Bootstrapper" module. This is a module which just imports the "PS-Get" module and starts up PsGet. The purpose of this bootstrapper is to allow PsGet to update itself using PsGet <img class="wlEmoticon wlEmoticon-smile" style="border-style: none;" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/wlEmoticon-smile_2.png" alt="Smile" />.</p>
<p>Once you've started PowerShell back up, you're all done! You now have two new commands. The first is "Get-PSPackage". I should warn you that this command is extremely simple right now and just lists every NuGet package from the main <a href="http://nuget.org">nuget.org</a> feed, so be prepared for it to take a few minutes when you run it. PsGet automatically works against the main NuGet feed at <a href="http://nuget.org">nuget.org</a>, but it doesn't really make sense to install packages like Entity Framework in to PowerShell. So, as a convention for now, packages on nuget.org which are PowerShell modules should have names which start "PS-". For example, I've already posted a very very simple package called PS-Bitz which is a library of useful functions (and by library, I mean a single function, for now <img class="wlEmoticon wlEmoticon-winkingsmile" style="border-style: none;" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/wlEmoticon-winkingsmile_2.png" alt="Winking smile" />). To find all the PowerShell packages, just go to nuget.org and search for "PS-", or just click <a href="http://nuget.org/Packages/Search?packageType=Packages&amp;searchCategory=All+Categories&amp;searchTerm=PS-">here</a>. Once you've found a package, just use the "Install-PSPackage" command to install it:</p>
<pre class="brush: ps">Install-PSPackage PS-Bitz</pre>
<p><a href="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_8.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="image" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_thumb_3.png" border="0" alt="image" width="406" height="113" /></a></p>
<p>Once the package is installed, you should be able to see it when you get the list of available PowerShell Modules:</p>
<p><a href="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_10.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="image" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_thumb_4.png" border="0" alt="image" width="608" height="261" /></a></p>
<p>(I'm not entirely sure why multiple entries show up, please <a href="http://scr.im/anurse">let me know</a> if you know why <img class="wlEmoticon wlEmoticon-smile" style="border-style: none;" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/wlEmoticon-smile_2.png" alt="Smile" />).</p>
<p>Now that it's installed, you can add it to your <strong>CURRENT</strong> shell by running Import-Module:</p>
<pre class="brush: ps">Import-Module PS-Bitz.0.1.0.0</pre>
<p>You can then use all the functions provided by it. In this package, there's a single function used to get the path of special folders like MyDocuments:</p>
<p><a href="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_12.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border-width: 0px;" title="image" src="http://dl.dropbox.com/u/17594081/BlogContent/03082011-Import/Windows-Live-Writer/46b266822777_DB0A/image_thumb_5.png" border="0" alt="image" width="432" height="112" /></a></p>
<p>If you want to make it available every time you launch PowerShell, just add an "Import-Module" line for it to your Profile, just as we did with PsGetBoot.</p>
<p>As you can probably see, PsGet is pretty rough around the edges right now, but I'm hoping to improve it over time. I've set up a BitBucket repository <a href="http://code.andrewnurse.net/psget">here</a>, so feel free to fork it and hack away. I'm licensing it under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache Public License</a>, which matches NuGet's license. <a href="http://scr.im/anurse">Let me know</a> what you think! And start posting PowerShell module packages to NuGet.org!</p>
