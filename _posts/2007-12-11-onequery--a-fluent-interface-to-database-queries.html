---
disqus_old: true
layout: post
title: "OneQuery - A Fluent Interface to Database Queries"
description: ""
category:
tags: []
permalink: /blog/2007/12/11/onequery-a-fluent-interface-to-database-queries.html
---
<p>Aside from my school work and my work on the <a href="http://www.dotnetnuke.com/tabid/824/default.aspx">DotNetNuke Reports Module</a> (very very close to release now), I've been tinkering with another project over the past few months. It's called OneQuery and its yet another Data Access Layer tool. OneQuery is designed to provide a &quot;<a href="http://en.wikipedia.org/wiki/Fluent_interface">fluent interface</a>&quot; to database queries. </p>  <p>What is a fluent interface? Wikipedia defines it as &quot;an object oriented construct that defines a behaviour capable of relaying the instruction context of a subsequent call&quot;. Essentially, it means that instead of writing code like this:</p>  <pre class="csharpcode">List&lt;<span class="kwrd">int</span>&gt; ints = <span class="kwrd">new</span> List&lt;<span class="kwrd">int</span>&gt;();<br/>ints.Add(1);<br/>ints.Add(2);<br/>ints.Add(3);</pre><br/><br/><p>You can write code like this</p><br/><br/><pre class="csharpcode">List&lt;<span class="kwrd">int</span>&gt; ints = <span class="kwrd">new</span> List&lt;<span class="kwrd">int</span>&gt;().Add(1).Add(2).Add(3);</pre><br/><br/><p>That's quite a savings and, in my opinion, it's much more readable.</p><br/><br/><h4>So, what's the point?</h4><br/><br/><p>Well, recently I've been thinking about the issue of database agnostic...ness (database agnostivity? database agnosticism?). I really want to be able to write data access code that will run on multiple database engines without having to manually translate it. <a href="http://www.dotnetnuke.com/">DotNetNuke</a> provides a, theoretically, database agnostic interface through Data Providers. However, to support another database engine, the core DataProvider must be translated, Stored Procedures must be converted and all sorts of &quot;Porting&quot; issues arise. Wouldn't it be nice if you could WORA (Write Once, Run Anywhere... a Java term) your SQL Scripts?</p><br/><br/><h4>Wait, hasn't this been done?</h4><br/><br/><p>Of course it has, and many many times. First, there's the elephant in the room, LINQ. However, aside from requiring .Net 3.5, if you want to write database agnostic code, you need to use something like the ADO.Net Entity Framework. OneQuery is designed to work in .Net 2.0, and I'm planning to write a LINQ layer on top of it so that you can write LINQ queries and run them on multiple database engines (not just SQL Server). I think OneQuery could serve as a &quot;migration path&quot; where you can write OneQuery syntax and then move to LINQ syntax when you're ready to move to .Net 3.5 while still keeping the database-agnostic OneQuery core.</p><br/><br/><p>There are a lot more database libraries out there as well. <a href="http://subsonicproject.com">SubSonic</a> provides an excellent Object/Relational Mapper (ORM) that allows you to work directly with objects, but sometimes you want a little more control. There are, of course, many others such as NHibernate, IBATIS.Net, and EntitySpaces. However, I found that while working with these tools I would find little things that would annoy me. For example, SubSonic does provide a way for you to directly query the database and get an IDataReader back, but it has an interface I found a little awkward (though it is a nice fluent interface). There are also smaller annoying features such as a lack of support for certain SQL statements (like &quot;INSERT&quot;) and a lack of JOIN support. On the other side, tools like NHibernate are really designed to allow you to ignore the database completely, which is a nice feature, but sometimes I need that direct database control.</p><br/><br/><h4></h4><br/><br/><h4></h4><br/><br/><h4>So, what is OneQuery?</h4><br/><br/><p>[Wow, I started two sub-headings off with 'so', perhaps that summer at Microsoft is affecting my patterns of speech. They say Microsofties tend to start there sentences with &quot;so&quot; and say &quot;drinking from a firehose&quot; and &quot;super&quot; a lot]</p><br/><br/><p>OneQuery is designed to let you focus on writing one query, and allows you to run the query on multiple database systems. Instead of using strings, which the compiler ignores, I wanted to provide a fluent interface and use operator overloading to make the queries as readable as possible.</p><br/><br/><h4>Enough already, get to the code!</h4><br/><br/><p>Ok, so here's a sample query using OneQuery's fluent syntax:</p><br/><br/><p><a href="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/WindowsLiveWriter/OneQueryAFluentInterfacetoDatabaseQuerie_1396C/query_4.png"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="88" alt="query" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/WindowsLiveWriter/OneQueryAFluentInterfacetoDatabaseQuerie_1396C/query_thumb_1.png" width="658" border="0" /></a> </p><br/><br/><p>(I posted it as a screenshot to make sure the spacing worked out, I'll post the text at the end if you want to copy it).</p><br/><br/><p>There are a few things I want to do to let you clear that up even further. For example, it would be much easier if you could write &quot;.OrderBy(Product.ListPrice).Desc()&quot;, or &quot;.Where(Product.ListPrice.Between(10).And(100))&quot;</p><br/><br/><p>Behind the scenes, the only other code you need to &quot;write&quot; is a helper class for the products table. I used quotes there because I'm planning on creating a code generator to do that for you.</p><br/><br/><h4>CAN HAZ CODE?</h4><br/><br/><p>Hopefully I've tantalized you a little bit and you'd like to check it out. You can download a preview release from our <a href="http://www.codeplex.com/onequery">CodePlex Project Site</a>, and discuss future features there as well. I'm planning a whole bunch of new features including (but definitely NOT limited to): </p><br/><br/><ul><br/>  <li>Support for ALL SQL DML Statements (INSERT, UPDATE, DELETE) </li><br/><br/>  <li>Full support for SELECT (including JOIN, GROUP BY, HAVING, and sub-queries) </li><br/><br/>  <li>A Code Generator to create the helper classes </li><br/><br/>  <li>and more! </li><br/></ul><br/><br/><p>Please let me know what you think! I want to make sure this system solves problems for as many people as possible, and the best way to do that is to get contributions from the community as early as possible. The <a href="http://www.codeplex.com/onequery">CodePlex site</a> has plenty of places to contribute, so please check it out!</p><br/><br/><h5>Sample Code in Text Form</h5><br/><br/><pre class="csharpcode">IDataReader rdr = Product.Query()<br/>                         .Where(Product.ListPrice &gt; 10 &amp; Product.ListPrice &lt; 100)<br/>                         .OrderBy(Product.ListPrice, SortDirection.Descending)<br/>                         .ExecuteReader();</pre><br/><br/><p><br/>  <div class="wlWriterSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:72e27e42-13fc-4276-bae4-35c1cd2093a5" style="padding-right: 0px; display: inline; padding-left: 0px; padding-bottom: 0px; margin: 0px; padding-top: 0px">Technorati Tags: <a href="http://technorati.com/tags/Data%20Access" rel="tag">Data Access</a>,<a href="http://technorati.com/tags/C#" rel="tag">C#</a>,<a href="http://technorati.com/tags/VB" rel="tag">VB</a>,<a href="http://technorati.com/tags/.Net" rel="tag">.Net</a>,<a href="http://technorati.com/tags/Fluent%20Interface" rel="tag">Fluent Interface</a>,<a href="http://technorati.com/tags/ORM" rel="tag">ORM</a></div></p>
