---
disqus_old: true
layout: post
title: "Inside Razor - Part 3 - Templates"
description: ""
category:
tags: []
permalink: /blog/2010/8/2/inside-razor-part-3-templates.html
---
<p>One of the features of Razor which hasn't been discussed a lot is the Inline Template feature.&nbsp; Razor includes the ability to provide an inline Razor template as an argument to a method.&nbsp; At the moment, this is only used by the Grid helper in ASP.Net Web Pages (and Scott Guthrie showed it back in his <a href="http://weblogs.asp.net/scottgu/archive/2010/07/02/introducing-razor.aspx">original blog post</a>).&nbsp; However, we don't have much documentation on how to create your own templated helpers yet, so I figured I'd talk a bit about it.</p>  <p>First, let's take a look at what code is generated when we use an inline template.&nbsp; I've written a sample templated helper called "Repeat" which just repeats the content of the template a specified number of times (we'll take a look at the implementation later).&nbsp; The page that uses this helper looks something like this:</p>  <br/><br/><pre class="csharp" name="code">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp; &lt;head&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Repeat Helper Demo&lt;/title&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/head&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp; &lt;body&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;Repeat Helper&lt;/p&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ul&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @Repeat(10, @&lt;li&gt;List Item&lt;/li&gt;);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/ul&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/body&gt;<br/>&lt;/html&gt;</pre><br/><br/><p>And when we run it, we get the following output:</p><br/><br/><p><a href="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/WindowsLiveWriter/InsideRazorPart3Templates_13B11/ss1_2.png"><img style="border-width: 0px; display: inline;" title="Screen shot of rendered HTML." alt="Screen shot of rendered HTML." src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/WindowsLiveWriter/InsideRazorPart3Templates_13B11/ss1_thumb.png" width="385" border="0" height="400"></a></p><br/><br/><p>Let's take a look at the implementation of "Repeat".&nbsp; I wrote it inline in the page in this case, but you could just as easily write it in a static class in App_Code and reference it that way.&nbsp; In Razor, the "@functions" block lets you write code that will be injected as-is into the body of the generated class.</p><br/><br/><pre class="csharp" name="code">@using System.Text;<br/>@functions {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static IHtmlString Repeat(int times, Func&lt;int, object&gt; template) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder builder = new StringBuilder();<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(int i = 0; i &lt; times; i++) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; builder.Append(template(i));<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new HtmlString(builder.ToString());<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br/>}</pre><br/><br/><p>So, the template is being passed in as a Func&lt;int, object&gt; and when we invoke it, we get back the result of running the template.&nbsp; But, if you look at line 6, you'll notice we're passing in an argument to the template function.&nbsp; Let's take a look at the C# that is generated when we write a call to Repeat.&nbsp; Here's the generated code to match the Razor code in the first code listing:</p><br/><br/><pre class="csharp" name="code">this.Write(Repeat(10,item =&gt; new Microsoft.WebPages.Helpers.HelperResult(__writer =&gt; {<br/>&nbsp;&nbsp;&nbsp;&nbsp; @__writer.Write(" ");<br/>&nbsp;&nbsp;&nbsp;&nbsp; @__writer.Write("&lt;li&gt;List Item&lt;/li&gt;");<br/>})));</pre><br/><br/><p>It's a little complex looking, but essentially, what's happening is that we're writing out a lambda which accepts a single parameter called "item" (the type of which is determined by the method you're passing it to).&nbsp; When that lambda runs, we construct and return a HelperResult.&nbsp; HelperResult is a class defined in the ASP.Net Web Pages framework, and it's essentially a wrapper around yet another delegate which writes text to a TextWriter.&nbsp; Think of it as a mini Razor template, when you invoke the delegate, it writes the content of the template.&nbsp; The advantage of wrapping the delegate up in the HelperResult class is that we can treat it just like a string in most places since it overrides ToString to return the result of executing the template.</p><br/><br/><p>The "item" parameter is used in helpers like the Grid helper to provide the current data item to the template so that it can be used.&nbsp; The Repeat helper passes in the iteration number as this parameter, which we can access from within the template by using "@item"?.&nbsp; For example:</p><br/><br/><pre class="csharp" name="code">@Repeat(10, @&lt;li&gt;List Item #@item&lt;/li&gt;);</pre><br/><br/><p>Which will render:</p><br/><br/><p><a href="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/WindowsLiveWriter/InsideRazorPart3Templates_13B11/ss2_2.png"><img style="border: 0px none; display: inline;" title="ss2" alt="ss2" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/WindowsLiveWriter/InsideRazorPart3Templates_13B11/ss2_thumb.png" width="324" border="0" height="373"></a> </p><br/><br/><p>In summary, if you want to use Razor templates in your helper methods, just add a parameter with the type Func&lt;<em>?</em>, object&gt; where <em>?</em> can be <strong>any</strong> type you want.&nbsp; As an interesting little exercise, try converting the Repeat helper to take an IEnumerable&lt;T&gt; and pass each item of that enumerable to the template, rendering the result.<br></p><br/><br/><p>I've uploaded the Razor file containing my sample helper here: <a href="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/RepeatHelper.cshtml.txt">RepeatHelper.cshtml.txt (.56 KB)</a> (Note: To avoid issues with file types on my hoster, it has a .txt extension, just remove that and you're good to go!)</p><br/><br/><p>Please feel free to ask questions in the comments, or by emailing me at andrew AT andrewnurse DOT net.&nbsp; I'm also on twitter at @anurse and I keep an eye on the "razor" tag on <a href="http://www.stackoverflow.com">StackOverflow</a> so there's no shortage of ways to ask!</p>
