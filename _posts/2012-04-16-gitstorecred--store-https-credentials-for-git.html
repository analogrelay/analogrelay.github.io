---
disqus_old: true
layout: post
title: "gitstorecred - Store HTTPS Credentials for Git"
description: ""
category:
tags: []
permalink: /blog/2012/4/16/gitstorecred-store-https-credentials-for-git.html
---
<p>UPDATE: Thanks to some help from <a href="http://paulbetts.org/">Paul Betts</a> this has been updated to use some new APIs in Git. Check out the blog post on the <a href="https://github.com/blog/1104-credential-caching-for-wrist-friendly-git-usage">GitHub Blog</a> for more info!</p>
<p>As you probably know, the ASP.Net team has moved to CodePlex for all of our out-of-band frameworks (MVC, WebPages, WebAPI, etc.). You probably also know that we are using the Git source control system on CodePlex. You may also know that CodePlex only supports the HTTPS transport for Git, which means that a username and password is required every time you push changes to the server:</p>
<p><a rel="lightbox" href="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/gitcred1.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px 0px 6px 2px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/gitcred1.png" border="0" alt="image" width="590" height="75" /></a></p>
<p>You can bypass the first prompt by adding your remote with &ldquo;https://username@server.com/path&rdquo;, and can even bypass the second by using &ldquo;https://username:password@server.com/path&rdquo; as the URL, but that&rsquo;s a really Bad Idea&trade;. So, like most modern systems, Git probably has a way to store these credentials, right?</p>
<p>Nope.</p>
<p>However, it does have an interesting extension point called &ldquo;AskPass&rdquo;. If you set the &ldquo;core.askpass&rdquo; config setting, or the GIT_ASKPASS environment variable, to the path to an executable, Git will run that executable every time it needs a username or password. It will pass the prompt it would have written to the console as the command line arguments to this program and it expects the program to write the credential it is requesting (username or password) to the standard output stream. We can use this to our advantage!</p>
<p>GitStoreCred is a small tool I created for doing exactly that. It allows you to replace the Git username and password prompt with a standard Windows credential dialog AND it will store those credentials in the Windows Credential Store (if you check the &ldquo;Remember&rdquo; checkbox). Let&rsquo;s see it in action:</p>
<p><a rel="lightbox" href="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/gitcred2.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px 0px 6px 2px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/gitcred2.png" border="0" alt="image" width="765" height="644" /></a></p>
<p>Much better! Once we enter our credentials, everything works and Git pushes happily to the server. Let&rsquo;s take a look at the Windows Credential Store now (this is in your Control Panel, go to User Accounts then Credential Manager):</p>
<p><a rel="lightbox" href="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/gitcred3.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/gitcred3.png" border="0" alt="image" width="593" height="400" /></a></p>
<p>See the highlighted entry? That&rsquo;s my credentials for CodePlex (you&rsquo;ll see I&rsquo;ve also got credentials for GitHub there). If I try to push again, git won&rsquo;t prompt me because gitstorecred just found the existing credential and outputted it.</p>
<h3>Enough talking, gimme gimme gimme!</h3>
<p>Ok, so you can <a href="https://github.com/downloads/anurse/git-credential-winstore/gitstorecred.exe">download</a> gitstorecred from GitHub and you can <a href="https://github.com/anurse/git-credential-winstore">view the code</a> there too. Just put the exe anywhere and set the GIT_ASKPASS environment variable to it&rsquo;s full path. I use my PowerShell profile script to do it, since I&rsquo;m always in PowerShell.</p>
<h3>WARNING! HERE BE DRAGONS!</h3>
<p>This is super hacky, I literally bashed it up over this weekend. It works, but I make no guarantees. The major known issues are the following:</p>
<p>First, if you type the wrong password, you have to go to Credential Manager (above) and either edit or just remove your credential. Gitstorecred has no way of getting feedback from Git so it doesn&rsquo;t know that your password was wrong (for example) and will just keep sending the wrong password. If you checked &ldquo;Remember&rdquo; then the only way to get it to prompt you again is to remove the credentials.</p>
<p>Second, it doesn&rsquo;t seem to get in the way of SSH-based pushing, but it might so be careful. If you ever find Git hanging when you run &ldquo;git push&rdquo;, just clear out the GIT_ASKPASS setting and try again. It&rsquo;s entirely possible gitstorecred isn&rsquo;t responding the way Git expects.</p>
<p>Third, we only store one set of credentials PER SERVER. That means that if you have two user accounts for some reason (say &ldquo;anurse&rdquo; and &ldquo;bnurse&rdquo;) for some server (say &ldquo;github.com&rdquo;), gitstorecred just stores the first one as the credentials for &ldquo;github.com&rdquo; and passes them along. Due to some issues with the Windows Credential API I use, it can&rsquo;t easily key the credential off your user account. For that reason, I <strong>highly</strong> recommend adding your git remote WITHOUT the user name (i.e. &ldquo;git remote add <a href="https://git01.codeplex.com/aspnetwebstack">https://git01.codeplex.com/aspnetwebstack</a>&rdquo;). That way gitstorecred will handle the username and password and you won&rsquo;t get in to weird issues. Of course, the credential store is per windows user, so if you have two separate users on the same machine, they can have different credentials for the same server.</p>
<p>Please do try it out though, the worst that should happen is it won&rsquo;t work and you&rsquo;ll have to turn it off. I&rsquo;m happy to take pull requests to try and make it more powerful/robust (for example, there are better Windows Credential APIs I could use but they are harder to access from Managed Code). With a tool like this, and the fact that Git is much smarter about HTTP pushing now, I&rsquo;m switching almost exclusively to HTTPS for my Git pushes.</p>
<p>Enjoy! Here&rsquo;s the links again: <a href="https://github.com/downloads/anurse/git-credential-winstore/gitstorecred.exe">Download EXE</a>, <a href="https://github.com/anurse/git-credential-winstore">Source Code on GitHub</a>.</p>
