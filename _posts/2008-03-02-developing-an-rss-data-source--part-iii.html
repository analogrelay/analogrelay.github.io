---
disqus_old: true
layout: post
title: "Developing an RSS Data Source - Part III"
description: ""
category:
tags: []
permalink: /blog/2008/3/2/developing-an-rss-data-source-part-iii.html
---
<P>In this series of blogs, I'm going to follow the development of an RSS Data Source. I'm going to use Visual Studio 2008, but I'll be using .Net 2.0 features so you should be able to follow along in Visual Studio 2005. You can also use the Express editions of Visual Web Developer (both 2005 and 2008 versions should work). All the code will be in VB.Net, but it should be straightforward enough for C# developers to understand (after all, its all .Net)</p><P>Continued from <A href="/2008/02/29/DevelopingAnRSSDataSourcePartII.aspx"><FONT color=#547699>Part II</FONT></A>.</p><H2>Part III - Settings</H2><br/><P>In this part, we're going to add a setting page so that we can change the RSS feed that our Data Source downloads.</p><P>In current versions of the Reports Module, Data Source settings are stored in the ModuleSettings table provided by DotNetNuke. This ensures that all copies of the same module instance will share the same Data Source settings (Visualizer settings are <STRONG>not</STRONG> shared between copies). However, Data Source developers need not (and <STRONG>should</STRONG> <STRONG>not</STRONG>) access these directly. Instead, the Reports Module provides a layer on top of the ModuleSettings table called "Data Source Settings". When the Data Source is executed, the Reports Module passes a Dictionary containing these settings (inside the ReportInfo object). To allow users to edit the settings, we go back to the Settings.ascx file we created in <A href="Part1.htm">Part I</A>.</p><P>Let's start with the user interface for our settings page. All we need for now is a place for the user to enter a feed URL. When we're done, it should look like the screenshot below</p><DIV class=captioned_image><IMG alt="The finished settings UI" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/RSSDataSource/Images/Part3/IE-FullFinishedSettings.png"> <br/><P class=caption>Figure 1 - The finished settings UI</P></DIV><br/><P>So, open up the <EM>Settings.ascx</EM> file and make sure you are in <KBD>Design</KBD> mode. First we need to add a label, so users know what they should type in our text box. In the Solution Explorer, find the file: <EM>controls/labelcontrol.ascx</EM> and drag it on to the design surface.</p><DIV class=captioned_image><IMG alt="Locating the LabelControl.ascx file" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/RSSDataSource/Images/Part3/VS-LabelControl.png"> <br/><P class=caption>Figure 2 - Locating the LabelControl.ascx file</P></DIV><br/><P>Next drag an ASP.Net TextBox control, from the Toolbox, on to the surface. You should have something that looks like this:</p><DIV class=captioned_image><IMG alt="Locating the LabelControl.ascx file" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/RSSDataSource/Images/Part3/VS-DesignSurface.png"> <br/><P class=caption>Figure 3 - Locating the LabelControl.ascx file</P></DIV><br/><P>Now, set the properties of the controls to the following values:</p><TABLE><br/><THEAD><br/><TR><br/><TH>Property</TH><br/><TH>Value for Label</TH><br/><TH>Value for Text Box</TH></TR></THEAD><br/><TBODY><br/><TR><br/><TD><KBD>ID</KBD></TD><br/><TD>feedUrlLabel</TD><br/><TD>feedUrlTextBox</TD></TR><br/><TR><br/><TD><KBD>ControlName</KBD></TD><br/><TD>feedUrlTextBox</TD><br/><TD>N/A</TD></TR><br/><TR><br/><TD><KBD>Width</KBD></TD><br/><TD>N/A</TD><br/><TD>100%</TD></TR></TBODY></TABLE><br/><P>Save your changes, and open up the code file: <EM>Settings.ascx.vb</EM>. Here, we need to add code to connect our text box to the Data Source settings. The key to this is the <KBD>LoadSettings</KBD> and <KBD>SaveSettings</KBD> methods provided by <KBD>ReportsSettingsBase</KBD>. First, we need to import some extra namespaces:</P><!--<br/>{rtf1ansiansicpglang1024noproof65001uc1 deff0{fonttbl{f0fnilfcharset0fprq1 Consolas;}}{colortbl;??red204green120blue50;red0green0blue0;red255green255blue255;}??fs26 cf1cb2highlight2 {b Imports}cf3 {b  DotNetNuke.Modules.Reports}par ??cf1 {b Imports}cf3 {b  System.Collections.Generic}}<br/>--><br/><DIV style="FONT-WEIGHT: bold; FONT-SIZE: 13pt; BACKGROUND: black; COLOR: white; FONT-FAMILY: Consolas"><br/><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">Imports</SPAN> DotNetNuke.Modules.Reports</p><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">Imports</SPAN> System.Collections.Generic</P></DIV><br/><P>Then, we can implement the <KBD>LoadSettings</KBD> and <KBD>SaveSettings</KBD> methods.</P><!--<br/>{rtf1ansiansicpglang1024noproof65001uc1 deff0{fonttbl{f0fnilfcharset0fprq1 Consolas;}}{colortbl;??red255green255blue255;red0green0blue0;red204green120blue50;red165green194blue92;}??fs26 cf1cb2highlight2 {b     }cf3 {b Public}cf1 {b  }cf3 {b Overrides}cf1 {b  }cf3 {b Sub}cf1 {b  LoadSettings(}cf3 {b ByVal}cf1 {b  Settings }cf3 {b As}cf1 {b  Dictionary(}cf3 {b Of}cf1 {b  }cf3 {b String}cf1 {b , }cf3 {b String}cf1 {b ))}par ??{b         }cf3 {b MyBase}cf1 {b .LoadSettings(Settings)}par ??{b         feedUrlTextBox.Text = SettingsUtil.GetDictionarySetting(Settings, _}par ??{b                                                                 }cf4 "FeedUrl"cf1 {b , _}par ??{b                                                                 }cf3 {b String}cf1 {b .Empty)}par ??{b     }cf3 {b End}cf1 {b  }cf3 {b Sub}par ??par ??cf1 {b     }cf3 {b Public}cf1 {b  }cf3 {b Overrides}cf1 {b  }cf3 {b Sub}cf1 {b  SaveSettings(}cf3 {b ByVal}cf1 {b  Settings }cf3 {b As}cf1 {b  Dictionary(}cf3 {b Of}cf1 {b  }cf3 {b String}cf1 {b , }cf3 {b String}cf1 {b ))}par ??{b         }cf3 {b MyBase}cf1 {b .SaveSettings(Settings)}par ??{b         Settings(}cf4 "FeedUrl"cf1 {b ) = feedUrlTextBox.Text}par ??{b     }cf3 {b End}cf1 {b  }cf3 {b Sub}}<br/>--><br/><DIV style="FONT-WEIGHT: bold; FONT-SIZE: 13pt; BACKGROUND: black; COLOR: white; FONT-FAMILY: Consolas"><br/><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">Public</SPAN> <SPAN style="COLOR: #cc7832">Overrides</SPAN> <SPAN style="COLOR: #cc7832">Sub</SPAN> LoadSettings(<SPAN style="COLOR: #cc7832">ByVal</SPAN> Settings <SPAN style="COLOR: #cc7832">As</SPAN> Dictionary(<SPAN style="COLOR: #cc7832">Of</SPAN> <SPAN style="COLOR: #cc7832">String</SPAN>, <SPAN style="COLOR: #cc7832">String</SPAN>))</p><P style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <SPAN style="COLOR: #cc7832">MyBase</SPAN>.LoadSettings(Settings)</p><P style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; feedUrlTextBox.Text = SettingsUtil.GetDictionarySetting(Settings, _</p><P style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <SPAN style="FONT-WEIGHT: normal; COLOR: #a5c25c">"FeedUrl"</SPAN>, _</p><P style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <SPAN style="COLOR: #cc7832">String</SPAN>.Empty)</p><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">End</SPAN> <SPAN style="COLOR: #cc7832">Sub</SPAN></p><P style="MARGIN: 0px">&nbsp;</p><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">Public</SPAN> <SPAN style="COLOR: #cc7832">Overrides</SPAN> <SPAN style="COLOR: #cc7832">Sub</SPAN> SaveSettings(<SPAN style="COLOR: #cc7832">ByVal</SPAN> Settings <SPAN style="COLOR: #cc7832">As</SPAN> Dictionary(<SPAN style="COLOR: #cc7832">Of</SPAN> <SPAN style="COLOR: #cc7832">String</SPAN>, <SPAN style="COLOR: #cc7832">String</SPAN>))</p><P style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <SPAN style="COLOR: #cc7832">MyBase</SPAN>.SaveSettings(Settings)</p><P style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; Settings(<SPAN style="FONT-WEIGHT: normal; COLOR: #a5c25c">"FeedUrl"</SPAN>) = feedUrlTextBox.Text</p><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">End</SPAN> <SPAN style="COLOR: #cc7832">Sub</SPAN></P></DIV><br/><P>The <KBD>LoadSettings</KBD> method is provided with a <KBD>System.Collections.Generic.Dictionary(Of String, String)</KBD> containing the current settings saved for the Data Source. Our implementation uses the <KBD>SettingsUtil</KBD> helper class (provided with the Reports Module) to retrieve a value from the dictionary, or return a default value if it doesn't exist (in this case, an empty string).</p><P>The <KBD>SaveSettings</KBD> method is also provided with the current settings. However, this method is responsible for retrieving the values entered by the user and updating the settings.</p><P>Save the file, and navigate to the Settings page on your test module. You should see our new Settings control displayed, as in the screenshot below:</p><DIV class=captioned_image><IMG alt="Settings page so far" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/RSSDataSource/Images/Part3/IE-EmptySettings.png"> <br/><P class=caption>Figure 4 - Settings page so far</P></DIV><br/><P>Oops, we still need to put the label text in! We're going to support the DotNetNuke Localization Framework, so we need to put the text in two places.</p><P>First, lets add the localized text. Create a Resource File called<EM> Settings.ascx.resx </EM>in <EM>/DesktopModules/Reports/DataSources/RSS/App_LocalResources</EM> file and open it. In Visual Studio, you get a nice table interface for editing resource strings. Add the following entries to the table (feel free to tweak the values as you want, just keep the name the same):</p><TABLE><br/><THEAD><br/><TR><br/><TH>Name</TH><br/><TH>Value</TH></TR></THEAD><br/><TBODY><br/><TR><br/><TD><KBD>feedUrlLabel.Text</KBD></TD><br/><TD>RSS Feed URL</TD></TR><br/><TR><br/><TD><KBD>feedUrlLabel.Help</KBD></TD><br/><TD>Enter the URL to an RSS feed to retrieve data from</TD></TR></TBODY></TABLE><br/><P>Your resource file should look like this after making those changes</p><DIV class=captioned_image><IMG alt="Resource File after entering values" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/RSSDataSource/Images/Part3/VS-ResourceFile.png"> <br/><P class=caption>Figure 5 - Resource File after entering values</P></DIV><br/><P>Now, go back to <EM>Settings.ascx</EM> and set the following properties on the label we created earlier:</p><TABLE><br/><THEAD><br/><TR><br/><TH>Property</TH><br/><TH>Value</TH></TR></THEAD><br/><TBODY><br/><TR><br/><TD><KBD>Text</KBD></TD><br/><TD>RSS Feed URL</TD></TR><br/><TR><br/><TD><KBD>Suffix</KBD></TD><br/><TD>:</TD></TR><br/><TR><br/><TD><KBD>CssClass</KBD></TD><br/><TD>SubHead</TD></TR></TBODY></TABLE><br/><P>Note: That's a colon (':') in the Suffix property. Also, <KBD>CssClass</KBD> is case sensitive.</p><P>Now, save and refresh your page. You should see something like the screen shot below:</p><DIV class=captioned_image><IMG alt="Finished Settings UI" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/RSSDataSource/Images/Part3/IE-FinishedSettingsUI.png"> <br/><P class=caption>Figure 6 - The finished Feed URL text box</P></DIV><br/><P>Now, to change our Data Source code to use this new setting. Let's go back to the <EM>/App_Code/RSSDataSource/RSSDataSource.vb</EM> file and take a look at the signature for the <KBD>ExecuteReport</KBD> method:</P><!--<br/>{rtf1ansiansicpglang1024noproof65001uc1 deff0{fonttbl{f0fnilfcharset0fprq1 Consolas;}}{colortbl;??red255green255blue255;red0green0blue0;red204green120blue50;}??fs26 cf1cb2highlight2 {b     }cf3 {b Public}cf1 {b  }cf3 {b Overrides}cf1 {b  }cf3 {b Function}cf1 {b  ExecuteReport(}cf3 {b ByVal}cf1 {b  report }cf3 {b As}cf1 {b  ReportInfo, _}par ??{b                                             }cf3 {b ByVal}cf1 {b  hostModule }cf3 {b As}cf1 {b  PortalModuleBase, _}par ??{b                                             }cf3 {b ByVal}cf1 {b  inputParameters }cf3 {b As}cf1 {b  IDictionary(}cf3 {b Of}cf1 {b  }cf3 {b String}cf1 {b , }cf3 {b Object}cf1 {b )) }cf3 {b As}cf1 {b  System.Data.DataView}par ??}<br/>--><br/><DIV style="FONT-WEIGHT: bold; FONT-SIZE: 13pt; BACKGROUND: black; COLOR: white; FONT-FAMILY: Consolas"><br/><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">Public</SPAN> <SPAN style="COLOR: #cc7832">Overrides</SPAN> <SPAN style="COLOR: #cc7832">Function</SPAN> ExecuteReport(<SPAN style="COLOR: #cc7832">ByVal</SPAN> report <SPAN style="COLOR: #cc7832">As</SPAN> ReportInfo, _</p><P style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <SPAN style="COLOR: #cc7832">ByVal</SPAN> hostModule <SPAN style="COLOR: #cc7832">As</SPAN> PortalModuleBase, _</p><P style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <SPAN style="COLOR: #cc7832">ByVal</SPAN> inputParameters <SPAN style="COLOR: #cc7832">As</SPAN> IDictionary(<SPAN style="COLOR: #cc7832">Of</SPAN> <SPAN style="COLOR: #cc7832">String</SPAN>, <SPAN style="COLOR: #cc7832">Object</SPAN>)) <SPAN style="COLOR: #cc7832">As</SPAN> System.Data.DataView</P></DIV><br/><P>The important parameter here is the <KBD>report</KBD> parameter. There is a property called <KBD>DataSourceSettings</KBD> on that object which contains the same dictionary we created in <KBD>SaveSettings</KBD>. First, delete the FeedUrl constant we were using before. Then add following code to the beginning of the <KBD>ExecuteReport</KBD> method to get the Feed URL from the settings:</P><!--<br/>{rtf1ansiansicpglang1024noproof65001uc1 deff0{fonttbl{f0fnilfcharset0fprq1 Consolas;}}{colortbl;??red255green255blue255;red0green0blue0;red204green120blue50;red165green194blue92;}??fs26 cf1cb2highlight2 {b         }cf3 {b If}cf1 {b  }cf3 {b Not}cf1 {b  report.DataSourceSettings.ContainsKey(}cf4 "FeedUrl"cf1 {b ) }cf3 {b Then}par ??cf1 {b             }cf3 {b Throw}cf1 {b  }cf3 {b New}cf1 {b  RequiredSettingMissingException(}cf4 "FeedUrl"cf1 {b , }cf3 {b MyBase}cf1 {b .ExtensionContext)}par ??{b         }cf3 {b End}cf1 {b  }cf3 {b If}par ??cf1 {b         }cf3 {b Dim}cf1 {b  feedUrl }cf3 {b As}cf1 {b  Uri = }cf3 {b Nothing}par ??cf1 {b         }cf3 {b If}cf1 {b  }cf3 {b Not}cf1 {b  Uri.TryCreate(report.DataSourceSettings(}cf4 "FeedUrl"cf1 {b ), UriKind.Absolute, feedUrl) }cf3 {b Then}par ??cf1 {b             }cf3 {b Throw}cf1 {b  }cf3 {b New}cf1 {b  RequiredSettingMissingException(}cf4 "FeedUrl"cf1 {b , }cf3 {b MyBase}cf1 {b .ExtensionContext)}par ??{b         }cf3 {b End}cf1 {b  }cf3 {b If}}<br/>--><br/><DIV style="FONT-WEIGHT: bold; FONT-SIZE: 13pt; BACKGROUND: black; COLOR: white; FONT-FAMILY: Consolas"><br/><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">If</SPAN> <SPAN style="COLOR: #cc7832">Not</SPAN> report.DataSourceSettings.ContainsKey(<SPAN style="FONT-WEIGHT: normal; COLOR: #a5c25c">"FeedUrl"</SPAN>) <SPAN style="COLOR: #cc7832">Then</SPAN></p><P style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <SPAN style="COLOR: #cc7832">Throw</SPAN> <SPAN style="COLOR: #cc7832">New</SPAN> RequiredSettingMissingException(<SPAN style="FONT-WEIGHT: normal; COLOR: #a5c25c">"FeedUrl"</SPAN>, <SPAN style="COLOR: #cc7832">MyBase</SPAN>.ExtensionContext)</p><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">End</SPAN> <SPAN style="COLOR: #cc7832">If</SPAN></p><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">Dim</SPAN> feedUrl <SPAN style="COLOR: #cc7832">As</SPAN> Uri = <SPAN style="COLOR: #cc7832">Nothing</SPAN></p><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">If</SPAN> <SPAN style="COLOR: #cc7832">Not</SPAN> Uri.TryCreate(report.DataSourceSettings(<SPAN style="FONT-WEIGHT: normal; COLOR: #a5c25c">"FeedUrl"</SPAN>), UriKind.Absolute, feedUrl) <SPAN style="COLOR: #cc7832">Then</SPAN></p><P style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <SPAN style="COLOR: #cc7832">Throw</SPAN> <SPAN style="COLOR: #cc7832">New</SPAN> RequiredSettingMissingException(<SPAN style="FONT-WEIGHT: normal; COLOR: #a5c25c">"FeedUrl"</SPAN>, <SPAN style="COLOR: #cc7832">MyBase</SPAN>.ExtensionContext)</p><P style="MARGIN: 0px"><SPAN style="COLOR: #cc7832">End</SPAN> <SPAN style="COLOR: #cc7832">If</SPAN></P></DIV><br/><P>This code checks for the setting, and if it isn't present or if it isn't a valid URL we throw an exception provided by the Reports Module: <KBD>RequiredSettingMissingException</KBD>. We pass it the name of our setting and some contextual information about our Data Source (which is provided automatically by our base class. If the setting isn't present, the Reports Module will automatically display a useful error message indicating that the setting is missing.</p><P>While we're in the code, let's add HTML Decoding directly to the Data Source, so we don't have to use the HTML Decode converter in the Module Settings. To do that, we change the line that adds entries to the output table so that it automatically HTML Decodes the description:</P><!--<br/>{rtf1ansiansicpglang1024noproof65001uc1 deff0{fonttbl{f0fnilfcharset0fprq1 Consolas;}}{colortbl;??red255green255blue255;red0green0blue0;red204green120blue50;}??fs26 cf1cb2highlight2 {b dt.Rows.Add(title, }cf3 {b New}cf1 {b  Uri(link), HttpUtility.HtmlDecode(description))}}<br/>--><br/><DIV style="FONT-WEIGHT: bold; FONT-SIZE: 13pt; BACKGROUND: black; COLOR: white; FONT-FAMILY: Consolas"><br/><P style="MARGIN: 0px">dt.Rows.Add(title, <SPAN style="COLOR: #cc7832">New</SPAN> Uri(link), HttpUtility.HtmlDecode(description))</P></DIV><br/><P>Make sure everything is saved and go back to the website. You should probably go back to the home page, just to make sure everything is properly recompiled. Go back to the settings page for the Reports Module, and make sure the RSS Data Source is selected. Then configure it with your favourite RSS feed. This time, I'll use my personal blog's RSS feed (WARNING: Shameless plug alert!).</p><DIV class=captioned_image><IMG alt="Testing the Settings UI" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/RSSDataSource/Images/Part3/IE-SettingsUITest.png"> <br/><P class=caption>Figure 7 - Testing the Settings UI</P></DIV><br/><P>Once you've done that, make sure the HTML Decode property is set and the HTML Visualizer is properly configured, just like in part 2 and click Update. You should see the RSS feed displayed just like in Part 2, only now we can change the URL!</p><DIV class=captioned_image><IMG alt="Final Results" src="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/RSSDataSource/Images/Part3/IE-Final.png"> <br/><P class=caption>Figure 8 - The Final Results</p><H3>Conclusion</H3></DIV><br/><P>At this point, we have a working RSS Data Source! You can stop here if you want, but in the next part I'll cover packaging the Data Source up so that it can be installed in any Reports Module installation.</p><P><A href="https://s3.amazonaws.com/vibrantcode-res/blogcontent/imported/RSSDataSource/Files/Part3.zip">Download the code so far.</A></P>
